{% extends "base.html" %}

{% block title %}Special Patterns Analysis{% endblock %}

{% block page_heading %}Special Patterns Analysis{% endblock %}

{% block content %}
<div class="space-y-8 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="card p-6 bg-white rounded-xl shadow-lg">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Special Number Patterns</h2>
        <p class="text-gray-700 mb-6">This page analyzes historical draws for specific "special" number patterns that might be of interest, such as numbers that are a multiple of 10 apart, numbers sharing the same last digit, or repeating digit numbers. The "Last Co-occurrence Date" column indicates the most recent date when *all* numbers in that specific pattern appeared together in the same draw. Click "Show All" to expand the full list for each category.</p>

        {# Tens-Apart Patterns Section #}
        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 text-gray-800">Tens-Apart Patterns (e.g., 10, 20; 55, 65)</h3>
            <p class="text-gray-700 mb-4">These are pairs of white balls where one number is exactly 10, 20, 30, 40, or 50 greater than the other. This table shows the most frequently occurring such pairs.</p>
            {% if special_patterns_data.tens_apart_patterns %}
                <div class="overflow-x-auto shadow-md rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pattern</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Co-occurrence Date</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="tensApartTableBody">
                            {% for pattern_data in special_patterns_data.tens_apart_patterns %}
                                <tr class="hover:bg-gray-50 {% if loop.index > 10 %}hidden{% endif %}">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        ({{ pattern_data.pattern_numbers | join(', ') }})
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ pattern_data.count }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ pattern_data.last_co_occurrence }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if special_patterns_data.tens_apart_patterns | length > 10 %}
                <div class="text-center mt-4">
                    <button id="tensApartToggleBtn" class="btn-secondary">Show All ({{ special_patterns_data.tens_apart_patterns | length }} entries)</button>
                </div>
                {% endif %}
            {% else %}
                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800">
                    No tens-apart patterns found.
                </div>
            {% endif %}
        </div>

        {# Same Last Digit Patterns Section #}
        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 text-gray-800">Same Last Digit Patterns (e.g., 9, 19, 29; 8, 28, 48, 58)</h3>
            <p class="text-gray-700 mb-4">These patterns consist of two or more white balls that share the same last digit. This table lists the most frequent occurrences of these vertical patterns.</p>
            {% if special_patterns_data.same_last_digit_patterns %}
                <div class="overflow-x-auto shadow-md rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pattern</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Co-occurrence Date</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="sameLastDigitTableBody">
                            {% for pattern_data in special_patterns_data.same_last_digit_patterns %}
                                <tr class="hover:bg-gray-50 {% if loop.index > 10 %}hidden{% endif %}">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        ({{ pattern_data.pattern_numbers | join(', ') }})
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ pattern_data.count }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ pattern_data.last_co_occurrence }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if special_patterns_data.same_last_digit_patterns | length > 10 %}
                <div class="text-center mt-4">
                    <button id="sameLastDigitToggleBtn" class="btn-secondary">Show All ({{ special_patterns_data.same_last_digit_patterns | length }} entries)</button>
                </div>
                {% endif %}
            {% else %}
                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800">
                    No same last digit patterns found.
                </div>
            {% endif %}
        </div>

        {# Repeating Digit Patterns Section #}
        <div>
            <h3 class="text-xl font-semibold mb-4 text-gray-800">Repeating Digit Patterns (e.g., 11, 22, 33)</h3>
            <p class="text-gray-700 mb-4">This section identifies occurrences of numbers with repeating digits (e.g., 11, 22, 33, 44, 55, 66) appearing together in a draw. The table shows the most frequent combinations.</p>
            {% if special_patterns_data.repeating_digit_patterns %}
                <div class="overflow-x-auto shadow-md rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pattern</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Co-occurrence Date</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="repeatingDigitTableBody">
                            {% for pattern_data in special_patterns_data.repeating_digit_patterns %}
                                <tr class="hover:bg-gray-50 {% if loop.index > 10 %}hidden{% endif %}">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        ({{ pattern_data.pattern_numbers | join(', ') }})
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ pattern_data.count }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ pattern_data.last_co_occurrence }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if special_patterns_data.repeating_digit_patterns | length > 10 %}
                <div class="text-center mt-4">
                    <button id="repeatingDigitToggleBtn" class="btn-secondary">Show All ({{ special_patterns_data.repeating_digit_patterns | length }} entries)</button>
                </div>
                {% endif %}
            {% else %}
                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800">
                    No repeating digit patterns found.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to toggle visibility of table rows
        function setupToggle(buttonId, tableBodyId, initialShowCount) {
            const toggleBtn = document.getElementById(buttonId);
            const tableBody = document.getElementById(tableBodyId);
            if (!toggleBtn || !tableBody) return;

            const rows = Array.from(tableBody.children);
            let isExpanded = false;

            // Initial state based on hidden class
            rows.forEach((row, index) => {
                if (index >= initialShowCount) {
                    row.classList.add('hidden');
                } else {
                    row.classList.remove('hidden');
                }
            });

            toggleBtn.addEventListener('click', function() {
                isExpanded = !isExpanded;
                rows.forEach((row, index) => {
                    if (index >= initialShowCount) {
                        if (isExpanded) {
                            row.classList.remove('hidden');
                        } else {
                            row.classList.add('hidden');
                        }
                    }
                });

                if (isExpanded) {
                    toggleBtn.textContent = 'Show Less';
                    // Optional: Add max-height and overflow-y for internal scrolling
                    tableBody.parentElement.style.maxHeight = '400px'; // Example max height
                    tableBody.parentElement.style.overflowY = 'auto';
                } else {
                    toggleBtn.textContent = `Show All (${rows.length} entries)`;
                    tableBody.parentElement.style.maxHeight = ''; // Remove max height
                    tableBody.parentElement.style.overflowY = '';
                }
            });
        }

        // Setup for each table
        setupToggle('tensApartToggleBtn', 'tensApartTableBody', 10);
        setupToggle('sameLastDigitToggleBtn', 'sameLastDigitTableBody', 10);
        setupToggle('repeatingDigitToggleBtn', 'repeatingDigitTableBody', 10);
    });
</script>
{% endblock %}
