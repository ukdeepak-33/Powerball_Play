<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Powerball Pattern Analysis 2019-2025</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        .header p {
            font-size: 1.2em;
            margin: 10px 0 0 0;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        .controls {
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 2px solid #dee2e6;
        }
        .control-section {
            margin-bottom: 20px;
        }
        .control-label {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #495057;
        }
        .year-tabs, .pattern-tabs {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .tab {
            padding: 12px 24px;
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .tab.active {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,123,255,0.3);
        }
        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        .pattern-tab {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        .pattern-tab.active {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .download-btn {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(40,167,69,0.3);
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(40,167,69,0.4);
        }
        .refresh-btn {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }
        .content {
            padding: 25px;
        }
        .month-section {
            margin-bottom: 35px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .month-header {
            background: linear-gradient(135deg, #343a40 0%, #23272b 100%);
            color: white;
            padding: 20px 25px;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .month-count {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: normal;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        th {
            background: linear-gradient(135deg, #495057 0%, #343a40 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }
        tr:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            transform: scale(1.001);
            transition: all 0.2s ease;
        }
        .numbers {
            font-weight: bold;
            color: #007bff;
            padding: 4px 8px;
            background: rgba(0,123,255,0.1);
            border-radius: 15px;
            margin: 2px;
            display: inline-block;
        }
        .powerball {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(220,53,69,0.3);
        }
        .matches {
            font-weight: bold;
            color: #28a745;
            text-align: left;
            padding-left: 15px;
        }
        .pattern-highlight {
            padding: 2px 6px;
            border-radius: 10px;
            margin: 2px;
            display: inline-block;
            font-size: 12px;
            font-weight: bold;
        }
        .same-digit { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
        .decade { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; }
        .consecutive { background: linear-gradient(135deg, #fd7e14 0%, #e65100 100%); color: white; }
        .repeated { background: linear-gradient(135deg, #6f42c1 0%, #495057 100%); color: white; }
        
        .no-data {
            text-align: center;
            padding: 50px;
            color: #6c757d;
            font-style: italic;
            background: white;
            font-size: 18px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #007bff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stat-label {
            color: #6c757d;
            margin-top: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        .yearly-summary {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #2196f3;
        }
        .summary-title {
            font-size: 18px;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 15px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .summary-month {
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 5px;
        }
        .summary-count {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }
        .pattern-legend {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #495057;
        }
        .legend-items {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .data-status {
            text-align: center;
            padding: 10px;
            margin: 10px 25px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        @media (max-width: 768px) {
            .year-tabs, .pattern-tabs {
                justify-content: center;
            }
            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }
            .download-btn {
                margin-top: 10px;
                width: 100%;
            }
            .month-header {
                flex-direction: column;
                gap: 10px;
            }
            table {
                font-size: 14px;
            }
            th, td {
                padding: 8px 5px;
            }
            .legend-items {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Advanced Powerball Pattern Analysis</h1>
            <p>Multi-Pattern Analysis: Same Digits • Decade Groups • Consecutive Numbers • Repeated Patterns (2019-2025)</p>
        </div>
        
        <div class="controls">
            <div id="data-status" class="data-status status-info">
                📊 Loading data from Supabase database...
            </div>
            
            <div class="control-section">
                <div class="control-label">📅 Select Year:</div>
                <div class="year-tabs">
                    <button class="tab active" onclick="showYear(2025)">2025</button>
                    <button class="tab" onclick="showYear(2024)">2024</button>
                    <button class="tab" onclick="showYear(2023)">2023</button>
                    <button class="tab" onclick="showYear(2022)">2022</button>
                    <button class="tab" onclick="showYear(2021)">2021</button>
                    <button class="tab" onclick="showYear(2020)">2020</button>
                    <button class="tab" onclick="showYear(2019)">2019</button>
                </div>
            </div>
            
            <div class="control-section">
                <div class="control-label">🔍 Select Pattern Type:</div>
                <div class="pattern-tabs">
                    <button class="tab pattern-tab active" onclick="showPattern('all')">All Patterns</button>
                    <button class="tab pattern-tab" onclick="showPattern('same-digit')">Same Last Digit</button>
                    <button class="tab pattern-tab" onclick="showPattern('decade')">Decade Groups</button>
                    <button class="tab pattern-tab" onclick="showPattern('consecutive')">Consecutive Numbers</button>
                    <button class="tab pattern-tab" onclick="showPattern('repeated')">Repeated Patterns</button>
                </div>
            </div>
            
            <div>
                <button class="download-btn" onclick="downloadExcel()">📊 Download Complete Analysis</button>
                <button class="download-btn refresh-btn" onclick="loadData()">🔄 Refresh Data</button>
            </div>
        </div>
        
        <div class="content">
            <div class="pattern-legend">
                <div class="legend-title">📋 Pattern Definitions:</div>
                <div class="legend-items">
                    <div class="legend-item">
                        <span class="pattern-highlight same-digit">Same Digit</span>
                        <span>Numbers ending in same digit (15, 25, 35)</span>
                    </div>
                    <div class="legend-item">
                        <span class="pattern-highlight decade">Decade</span>
                        <span>Numbers in same decade (20-29, 30-39)</span>
                    </div>
                    <div class="legend-item">
                        <span class="pattern-highlight consecutive">Consecutive</span>
                        <span>Sequential numbers (12, 13, 14)</span>
                    </div>
                    <div class="legend-item">
                        <span class="pattern-highlight repeated">Repeated</span>
                        <span>Double digits (11, 22, 33, 44)</span>
                    </div>
                </div>
            </div>
            
            <div class="stats" id="stats">
                <!-- Stats will be populated by JavaScript -->
            </div>
            
            <div class="yearly-summary" id="yearly-summary">
                <!-- Yearly summary will be populated by JavaScript -->
            </div>
            
            <div id="data-container">
                <!-- Data will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // --- Supabase Configuration ---
        const SUPABASE_CONFIG = {
            url: "https://yksxzbbcoitehdmsxqex.supabase.co",
            key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlrc3h6YmJjb2l0ZWhkbXN4cWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NzMwNjUsImV4cCI6MjA2NTM0OTA2NX0.AzUD7wjR7VbvtUH27NDqJ3AlvFW0nCWpiN9ADG8T_t4"
        };

        const SUPABASE_TABLE_NAME = 'powerball_draws';

        let allData = [];
        let currentYear = 2025;
        let currentPattern = 'all';
        let dataSource = 'manual';

        // Initialize Supabase client
        const supabase = SUPABASE_CONFIG.url && SUPABASE_CONFIG.key 
            ? supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key)
            : null;

        // Manual data as fallback (truncated for brevity)
        const manualData = `Draw Date	Number 1	Number 2	Number 3	Number 4	Number 5	Powerball
2019-01-02	8	12	42	46	56	12
2019-01-05	3	7	15	27	69	19
2019-01-09	6	19	37	49	59	22
2019-01-12	7	36	48	57	58	24
2025-09-24	15	31	45	49	53	19`;

        // Data management functions
        async function fetchDataFromSupabase() {
            if (!supabase) {
                console.log('Supabase not configured');
                return null;
            }

            try {
                showStatus('📊 Loading live data from Supabase...', 'info');
                
                const { data, error } = await supabase
                    .from(SUPABASE_TABLE_NAME)
                    .select('*')
                    .order('draw_date', { ascending: true });

                if (error) {
                    throw new Error(`Supabase error: ${error.message}`);
                }

                if (data && data.length > 0) {
                    console.log(`Fetched ${data.length} records from Supabase`);
                    return data.map(draw => ({
                        date: draw.draw_date,
                        numbers: [
                            parseInt(draw.number1),
                            parseInt(draw.number2),
                            parseInt(draw.number3),
                            parseInt(draw.number4),
                            parseInt(draw.number5)
                        ],
                        powerball: parseInt(draw.powerball)
                    }));
                }
                
                return null;
            } catch (error) {
                console.error('Error fetching from Supabase:', error);
                showStatus('❌ Database error: ' + error.message, 'error');
                return null;
            }
        }

        function parseManualData() {
            const lines = manualData.trim().split('\n');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split('\t');
                if (values.length === 7) {
                    data.push({
                        date: values[0].trim(),
                        numbers: [
                            parseInt(values[1]),
                            parseInt(values[2]),
                            parseInt(values[3]),
                            parseInt(values[4]),
                            parseInt(values[5])
                        ],
                        powerball: parseInt(values[6])
                    });
                }
            }
            return data;
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('data-status');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.display = 'block';
                statusEl.className = 'data-status ';
                
                switch (type) {
                    case 'success':
                        statusEl.classList.add('status-success');
                        break;
                    case 'error':
                        statusEl.classList.add('status-error');
                        break;
                    default:
                        statusEl.classList.add('status-info');
                }
                
                // Auto-hide success messages after 3 seconds
                if (type === 'success') {
                    setTimeout(() => {
                        statusEl.style.display = 'none';
                    }, 3000);
                }
            }
        }

        async function loadData() {
            showStatus('🔄 Loading data...', 'info');
            
            // Try to fetch from Supabase first
            const supabaseData = await fetchDataFromSupabase();
            
            if (supabaseData && supabaseData.length > 0) {
                allData = supabaseData;
                dataSource = 'supabase';
                showStatus('✅ Live data loaded from Supabase!', 'success');
                console.log(`Loaded ${allData.length} draws from Supabase`);
            } else {
                // Fallback to manual data
                allData = parseManualData();
                dataSource = 'manual';
                showStatus('⚠️ Using manual data (database unavailable)', 'error');
                console.log(`Loaded ${allData.length} draws from manual data`);
            }
            
            // Update the header to show data source
            updateDataSourceIndicator();
            
            // Refresh the display
            displayData(currentYear, currentPattern);
        }

        function updateDataSourceIndicator() {
            const header = document.querySelector('.header p');
            if (header) {
                const originalText = 'Multi-Pattern Analysis: Same Digits • Decade Groups • Consecutive Numbers • Repeated Patterns (2019-2025)';
                const sourceIndicator = dataSource === 'supabase' 
                    ? ' 🟢 Live Database' 
                    : ' ⚠️ Manual Data';
                
                header.textContent = originalText + sourceIndicator;
            }
        }

        // Pattern analysis functions
        function findSameLastDigitMatches(numbers) {
            const digitGroups = {};
            const matches = [];
            
            numbers.forEach(num => {
                const lastDigit = num % 10;
                if (!digitGroups[lastDigit]) {
                    digitGroups[lastDigit] = [];
                }
                digitGroups[lastDigit].push(num);
            });
            
            Object.keys(digitGroups).forEach(digit => {
                if (digitGroups[digit].length >= 2) {
                    matches.push({
                        type: 'same-digit',
                        digit: parseInt(digit),
                        numbers: digitGroups[digit],
                        count: digitGroups[digit].length
                    });
                }
            });
            
            return matches;
        }

        function findDecadeMatches(numbers) {
            const decadeGroups = {};
            const matches = [];
            
            numbers.forEach(num => {
                const decade = Math.floor(num / 10) * 10;
                if (!decadeGroups[decade]) {
                    decadeGroups[decade] = [];
                }
                decadeGroups[decade].push(num);
            });
            
            Object.keys(decadeGroups).forEach(decade => {
                if (decadeGroups[decade].length >= 2) {
                    matches.push({
                        type: 'decade',
                        decade: parseInt(decade),
                        numbers: decadeGroups[decade],
                        count: decadeGroups[decade].length
                    });
                }
            });
            
            return matches;
        }

        function findConsecutiveMatches(numbers) {
            const sortedNumbers = [...numbers].sort((a, b) => a - b);
            const matches = [];
            let currentSequence = [sortedNumbers[0]];
            
            for (let i = 1; i < sortedNumbers.length; i++) {
                if (sortedNumbers[i] === sortedNumbers[i-1] + 1) {
                    currentSequence.push(sortedNumbers[i]);
                } else {
                    if (currentSequence.length >= 2) {
                        matches.push({
                            type: 'consecutive',
                            numbers: [...currentSequence],
                            count: currentSequence.length
                        });
                    }
                    currentSequence = [sortedNumbers[i]];
                }
            }
            
            if (currentSequence.length >= 2) {
                matches.push({
                    type: 'consecutive',
                    numbers: [...currentSequence],
                    count: currentSequence.length
                });
            }
            
            return matches;
        }

        function findRepeatedPatterns(numbers) {
            const matches = [];
            
            numbers.forEach(num => {
                const tens = Math.floor(num / 10);
                const ones = num % 10;
                
                if (tens === ones && num >= 11) {
                    matches.push({
                        type: 'repeated',
                        pattern: 'double-digit',
                        number: num,
                        count: 1
                    });
                }
            });
            
            const groupedMatches = {};
            matches.forEach(match => {
                if (!groupedMatches[match.pattern]) {
                    groupedMatches[match.pattern] = [];
                }
                groupedMatches[match.pattern].push(match.number);
            });
            
            const result = [];
            Object.keys(groupedMatches).forEach(pattern => {
                if (groupedMatches[pattern].length >= 1) {
                    result.push({
                        type: 'repeated',
                        pattern: pattern,
                        numbers: groupedMatches[pattern],
                        count: groupedMatches[pattern].length
                    });
                }
            });
            
            return result;
        }

        function analyzePatterns(draw) {
            const patterns = [];
            patterns.push(...findSameLastDigitMatches(draw.numbers));
            patterns.push(...findDecadeMatches(draw.numbers));
            patterns.push(...findConsecutiveMatches(draw.numbers));
            patterns.push(...findRepeatedPatterns(draw.numbers));
            return patterns;
        }

        function analyzeYear(year, patternType = 'all') {
            const yearData = allData.filter(draw => draw.date.startsWith(year.toString()));
            const monthlyData = {};
            
            for (let month = 1; month <= 12; month++) {
                monthlyData[month] = [];
            }
            
            yearData.forEach(draw => {
                const month = parseInt(draw.date.split('-')[1]);
                const patterns = analyzePatterns(draw);
                
                const filteredPatterns = patternType === 'all' 
                    ? patterns 
                    : patterns.filter(p => p.type === patternType);
                
                if (filteredPatterns.length > 0) {
                    monthlyData[month].push({
                        ...draw,
                        patterns: filteredPatterns
                    });
                }
            });
            
            return monthlyData;
        }

        function showYear(year) {
            currentYear = year;
            document.querySelectorAll('.year-tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            displayData(year, currentPattern);
        }

        function showPattern(patternType) {
            currentPattern = patternType;
            document.querySelectorAll('.pattern-tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            displayData(currentYear, patternType);
        }

        function displayData(year, patternType) {
            const yearData = analyzeYear(year, patternType);
            const container = document.getElementById('data-container');
            const statsContainer = document.getElementById('stats');
            const summaryContainer = document.getElementById('yearly-summary');
            
            // Calculate stats
            let totalMatches = 0;
            let patternCounts = {
                'same-digit': 0,
                'decade': 0,
                'consecutive': 0,
                'repeated': 0
            };
            
            Object.values(yearData).forEach(monthData => {
                totalMatches += monthData.length;
                monthData.forEach(draw => {
                    draw.patterns.forEach(pattern => {
                        patternCounts[pattern.type]++;
                    });
                });
            });
            
            const allYearDraws = allData.filter(draw => draw.date.startsWith(year.toString())).length;
            const percentage = ((totalMatches / allYearDraws) * 100).toFixed(1);
            
            let bestMonth = 0, bestCount = 0;
            Object.entries(yearData).forEach(([month, data]) => {
                if (data.length > bestCount) {
                    bestCount = data.length;
                    bestMonth = month;
                }
            });
            
            const monthNames = ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // Update stats
            let statsHtml = '';
            if (patternType === 'all') {
                statsHtml = `
                    <div class="stat-card">
                        <div class="stat-number">${totalMatches}</div>
                        <div class="stat-label">Total Pattern Matches in ${year}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${allYearDraws}</div>
                        <div class="stat-label">Total Draws in ${year}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${percentage}%</div>
                        <div class="stat-label">Pattern Frequency Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${monthNames[bestMonth]} (${bestCount})</div>
                        <div class="stat-label">Best Month for Patterns</div>
                    </div>
                `;
            } else {
                const patternName = patternType === 'same-digit' ? 'Same Last Digit' :
                                  patternType === 'decade' ? 'Decade Groups' :
                                  patternType === 'consecutive' ? 'Consecutive Numbers' : 'Repeated Patterns';
                
                statsHtml = `
                    <div class="stat-card">
                        <div class="stat-number">${patternCounts[patternType]}</div>
                        <div class="stat-label">${patternName} Matches in ${year}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${allYearDraws}</div>
                        <div class="stat-label">Total Draws in ${year}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${((patternCounts[patternType] / allYearDraws) * 100).toFixed(1)}%</div>
                        <div class="stat-label">${patternName} Frequency</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${monthNames[bestMonth]} (${bestCount})</div>
                        <div class="stat-label">Best Month for ${patternName}</div>
                    </div>
                `;
            }
            
            statsContainer.innerHTML = statsHtml;
            
            // Create yearly summary
            summaryContainer.innerHTML = `
                <div class="summary-title">📅 ${year} Monthly Breakdown - Pattern Match Counts</div>
                <div class="summary-grid">
                    ${Object.entries(yearData).map(([month, data]) => `
                        <div class="summary-item">
                            <div class="summary-month">${monthNames[month]}</div>
                            <div class="summary-count">${data.length}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Display monthly data
            let html = '';
            const fullMonthNames = [
                '', 'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            
            for (let month = 1; month <= 12; month++) {
                const monthData = yearData[month];
                
                html += `<div class="month-section">
                    <div class="month-header">
                        ${fullMonthNames[month]} ${year}
                        <span class="month-count">${monthData.length} pattern matches found</span>
                    </div>`;
                
                if (monthData.length > 0) {
                    html += `<table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Numbers</th>
                                <th>Powerball</th>
                                <th>Pattern Matches</th>
                                <th>Total Pattern Count</th>
                            </tr>
                        </thead>
                        <tbody>`;
                    
                    monthData.forEach(draw => {
                        const numbersHtml = draw.numbers.map(num => `<span class="numbers">${num}</span>`).join(' ');
                        
                        const patternsHtml = draw.patterns.map(pattern => {
                            let patternText = '';
                            let patternClass = '';
                            
                            switch (pattern.type) {
                                case 'same-digit':
                                    patternText = `Same Last Digit ${pattern.digit}: ${pattern.numbers.join(', ')}`;
                                    patternClass = 'same-digit';
                                    break;
                                case 'decade':
                                    patternText = `Decade ${pattern.decade}s: ${pattern.numbers.join(', ')}`;
                                    patternClass = 'decade';
                                    break;
                                case 'consecutive':
                                    patternText = `Consecutive: ${pattern.numbers.join(', ')}`;
                                    patternClass = 'consecutive';
                                    break;
                                case 'repeated':
                                    patternText = `Repeated ${pattern.pattern}: ${pattern.numbers.join(', ')}`;
                                    patternClass = 'repeated';
                                    break;
                            }
                            
                            return `<span class="pattern-highlight ${patternClass}">${patternText}</span>`;
                        }).join('<br>');
                        
                        const totalPatternCount = draw.patterns.reduce((sum, pattern) => sum + pattern.count, 0);
                        
                        html += `<tr>
                            <td><strong>${draw.date}</strong></td>
                            <td>${numbersHtml}</td>
                            <td><span class="powerball">${draw.powerball}</span></td>
                            <td class="matches">${patternsHtml}</td>
                            <td><strong style="color: #28a745; font-size: 18px;">${totalPatternCount}</strong></td>
                        </tr>`;
                    });
                    
                    html += `</tbody></table>`;
                } else {
                    html += `<div class="no-data">No ${patternType === 'all' ? 'pattern' : patternType} matches found in ${fullMonthNames[month]} ${year}</div>`;
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function downloadExcel() {
            // Your existing downloadExcel function implementation
            // (I've omitted it for brevity, but you can add it back)
            alert('Excel download functionality would be implemented here');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
